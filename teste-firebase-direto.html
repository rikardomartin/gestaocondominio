<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Firebase Direto</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { color: #2563eb; text-align: center; }
        .test-section {
            background: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border: 1px solid #e2e8f0;
        }
        button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            font-weight: 500;
        }
        button:hover { background: #1d4ed8; }
        button:disabled { background: #94a3b8; cursor: not-allowed; }
        .result {
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            font-weight: 500;
        }
        .success { background: #dcfce7; color: #166534; border: 1px solid #bbf7d0; }
        .error { background: #fef2f2; color: #dc2626; border: 1px solid #fecaca; }
        .info { background: #dbeafe; color: #1e40af; border: 1px solid #bfdbfe; }
        input {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 16px;
            box-sizing: border-box;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî• Teste Firebase Direto</h1>
        
        <div class="test-section">
            <h3>üß™ Teste Manual</h3>
            <input type="email" id="testEmail" placeholder="Email para testar" value="admin.condominio@gmail.com">
            <input type="password" id="testPassword" placeholder="Senha" value="123456">
            <button onclick="testDirectLogin()">üîç Testar Login Direto</button>
        </div>

        <div class="test-section">
            <h3>‚ö° Testes Autom√°ticos</h3>
            <button onclick="testAllUsers()">üöÄ Testar Todos os Usu√°rios</button>
            <button onclick="createWorkingUser()">‚ûï Criar Usu√°rio Funcional</button>
        </div>

        <div id="results"></div>
    </div>

    <script type="module">
        import { signInWithEmailAndPassword, createUserWithEmailAndPassword, updateProfile } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { auth } from './firebase-config.js';

        const results = document.getElementById('results');

        window.testDirectLogin = async function() {
            const email = document.getElementById('testEmail').value.trim();
            const password = document.getElementById('testPassword').value.trim();
            
            if (!email || !password) {
                showResult('Por favor, preencha email e senha', 'error');
                return;
            }
            
            await testLogin(email, password);
        };

        window.testAllUsers = async function() {
            results.innerHTML = '<div class="info">üîç Testando todos os usu√°rios...</div>';
            
            const testUsers = [
                { email: 'admin.condominio@gmail.com', password: '123456', name: 'Admin Gmail' },
                { email: 'operador.condominio@gmail.com', password: '123456', name: 'Operador Gmail' },
                { email: 'viewer.condominio@gmail.com', password: '123456', name: 'Viewer Gmail' },
                { email: 'admin@condominio.com', password: '123456', name: 'Admin Antigo' },
                { email: 'operador@condominio.com', password: '123456', name: 'Operador Antigo' },
                { email: 'viewer@condominio.com', password: '123456', name: 'Viewer Antigo' }
            ];
            
            let workingUsers = [];
            let failedUsers = [];
            
            for (const user of testUsers) {
                try {
                    const userCredential = await signInWithEmailAndPassword(auth, user.email, user.password);
                    workingUsers.push({ ...user, uid: userCredential.user.uid });
                    await auth.signOut(); // Logout para pr√≥ximo teste
                } catch (error) {
                    failedUsers.push({ ...user, error: error.code });
                }
            }
            
            let resultHtml = '<div class="info"><h3>üìä Resultados dos Testes:</h3></div>';
            
            if (workingUsers.length > 0) {
                resultHtml += '<div class="success"><h4>‚úÖ Usu√°rios que FUNCIONAM:</h4>';
                workingUsers.forEach(user => {
                    resultHtml += `<p><strong>${user.name}:</strong> ${user.email} (UID: ${user.uid.substring(0, 8)}...)</p>`;
                });
                resultHtml += '</div>';
            }
            
            if (failedUsers.length > 0) {
                resultHtml += '<div class="error"><h4>‚ùå Usu√°rios que FALHARAM:</h4>';
                failedUsers.forEach(user => {
                    resultHtml += `<p><strong>${user.name}:</strong> ${user.email} - ${user.error}</p>`;
                });
                resultHtml += '</div>';
            }
            
            if (workingUsers.length === 0) {
                resultHtml += '<div class="error"><h4>üö® NENHUM USU√ÅRIO FUNCIONA!</h4><p>Todos os usu√°rios falharam no login. Vamos criar um usu√°rio funcional.</p></div>';
            }
            
            results.innerHTML = resultHtml;
        };

        window.createWorkingUser = async function() {
            const email = 'teste.sistema@gmail.com';
            const password = '123456';
            const name = 'Usu√°rio Teste Sistema';
            
            showResult('‚ûï Criando usu√°rio funcional...', 'info');
            
            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                
                await updateProfile(user, {
                    displayName: name
                });
                
                showResult(`‚úÖ Usu√°rio criado com sucesso!<br><br>
                    <strong>Email:</strong> ${email}<br>
                    <strong>Senha:</strong> ${password}<br>
                    <strong>UID:</strong> ${user.uid}<br><br>
                    üéâ Use este usu√°rio para fazer login na aplica√ß√£o!`, 'success');
                
            } catch (error) {
                let errorMessage = error.message;
                if (error.code === 'auth/email-already-in-use') {
                    // Se j√° existe, vamos testar se funciona
                    showResult('üìß Email j√° existe, testando login...', 'info');
                    await testLogin(email, password);
                } else {
                    showResult(`‚ùå Erro ao criar usu√°rio: ${errorMessage}`, 'error');
                }
            }
        };

        async function testLogin(email, password) {
            showResult(`üîç Testando login: ${email}...`, 'info');
            
            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                
                showResult(`‚úÖ LOGIN BEM-SUCEDIDO!<br><br>
                    <strong>Email:</strong> ${user.email}<br>
                    <strong>UID:</strong> ${user.uid}<br>
                    <strong>Nome:</strong> ${user.displayName || 'N√£o definido'}<br>
                    <strong>Verificado:</strong> ${user.emailVerified ? 'Sim' : 'N√£o'}<br>
                    <strong>Criado em:</strong> ${new Date(user.metadata.creationTime).toLocaleString('pt-BR')}<br><br>
                    üéâ Este usu√°rio funciona! Use-o na aplica√ß√£o principal.<br>
                    <a href="https://gestaodoscondominios.web.app" target="_blank" style="color: #2563eb; font-weight: bold;">üöÄ Abrir Aplica√ß√£o</a>`, 'success');
                
                // Fazer logout para permitir outros testes
                setTimeout(() => {
                    auth.signOut();
                }, 2000);
                
            } catch (error) {
                let errorMessage = error.message;
                let errorCode = error.code;
                
                if (errorCode === 'auth/invalid-credential') {
                    errorMessage = 'Credenciais inv√°lidas - usu√°rio n√£o existe ou senha incorreta';
                } else if (errorCode === 'auth/user-not-found') {
                    errorMessage = 'Usu√°rio n√£o encontrado no Firebase Authentication';
                } else if (errorCode === 'auth/wrong-password') {
                    errorMessage = 'Senha incorreta';
                } else if (errorCode === 'auth/invalid-email') {
                    errorMessage = 'Formato de email inv√°lido';
                } else if (errorCode === 'auth/user-disabled') {
                    errorMessage = 'Usu√°rio foi desabilitado';
                }
                
                showResult(`‚ùå ERRO NO LOGIN<br><br>
                    <strong>Email:</strong> ${email}<br>
                    <strong>C√≥digo:</strong> ${errorCode}<br>
                    <strong>Mensagem:</strong> ${errorMessage}<br><br>
                    üí° Este usu√°rio n√£o funciona ou n√£o existe.`, 'error');
            }
        }

        function showResult(message, type) {
            results.innerHTML = `<div class="${type}">${message}</div>`;
        }
    </script>
</body>
</html>