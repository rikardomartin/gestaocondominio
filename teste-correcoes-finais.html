<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§ª Teste CorreÃ§Ãµes Finais - Status Acordo + OrganizaÃ§Ã£o Casas</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .title {
            text-align: center;
            color: #2563eb;
            margin-bottom: 30px;
            font-size: 28px;
            font-weight: 700;
        }

        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .test-section {
            background: #f8fafc;
            border-radius: 12px;
            padding: 20px;
            border-left: 4px solid #2563eb;
        }

        .test-section h3 {
            margin-top: 0;
            color: #1e293b;
        }

        .test-button {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            margin: 5px;
            transition: all 0.3s ease;
            width: 100%;
            font-size: 14px;
        }

        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(37, 99, 235, 0.3);
        }

        .test-button.success {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .test-button.warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .log-area {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
            margin: 20px 0;
            grid-column: 1 / -1;
        }

        .status-demo {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 15px 0;
        }

        .status-card {
            padding: 10px 15px;
            border-radius: 8px;
            border: 2px solid #e5e7eb;
            text-align: center;
            min-width: 100px;
        }

        .status-card.status-acordo {
            border-color: #f59e0b;
            background: #fef3c7;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-badge.status-acordo {
            background-color: #f59e0b;
            color: white;
        }

        .house-structure {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        .house-structure h4 {
            margin: 0 0 10px 0;
            color: #0c4a6e;
        }

        .house-list {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .house-item {
            background: #0ea5e9;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }

        .success { color: #10b981; }
        .error { color: #ef4444; }
        .warning { color: #f59e0b; }
        .info { color: #3b82f6; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">ğŸ§ª Teste CorreÃ§Ãµes Finais</h1>
        <p style="text-align: center; color: #64748b; margin-bottom: 30px;">
            VerificaÃ§Ã£o do Status "Acordo" + OrganizaÃ§Ã£o das Casas
        </p>

        <div class="test-grid">
            <!-- SeÃ§Ã£o 1: Status Acordo -->
            <div class="test-section">
                <h3>ğŸ¯ Status "Acordo"</h3>
                <div class="status-demo">
                    <div class="status-card status-acordo">
                        <div>Acordo</div>
                        <div class="status-badge status-acordo">Acordo</div>
                    </div>
                </div>
                <button class="test-button" onclick="testStatusAcordo()">
                    ğŸ§ª Testar Status Acordo
                </button>
                <button class="test-button" onclick="testModalFunctionality()">
                    ğŸ“± Testar Modal
                </button>
                <button class="test-button" onclick="testStatusPersistence()">
                    ğŸ’¾ Testar PersistÃªncia
                </button>
            </div>

            <!-- SeÃ§Ã£o 2: OrganizaÃ§Ã£o Casas -->
            <div class="test-section">
                <h3>ğŸ  OrganizaÃ§Ã£o das Casas</h3>
                <div class="house-structure">
                    <h4>Vacaria - Bloco 25</h4>
                    <div class="house-list">
                        <div class="house-item">Casa 01</div>
                        <div class="house-item">Casa 02</div>
                        <div class="house-item">Casa 03</div>
                        <div class="house-item">Casa 04</div>
                    </div>
                </div>
                <button class="test-button" onclick="testHouseStructure()">
                    ğŸ—ï¸ Testar Estrutura Casas
                </button>
                <button class="test-button" onclick="testDuplicatePrevention()">
                    ğŸš« Testar PrevenÃ§Ã£o Duplicatas
                </button>
                <button class="test-button" onclick="validateHouseOrganization()">
                    âœ… Validar OrganizaÃ§Ã£o
                </button>
            </div>

            <!-- SeÃ§Ã£o 3: Testes Sistema -->
            <div class="test-section">
                <h3>âš™ï¸ Sistema Geral</h3>
                <button class="test-button" onclick="testFirebaseConnection()">
                    ğŸ”¥ ConexÃ£o Firebase
                </button>
                <button class="test-button" onclick="testServiceWorker()">
                    ğŸ”„ Service Worker
                </button>
                <button class="test-button" onclick="testAuthentication()">
                    ğŸ” AutenticaÃ§Ã£o
                </button>
                <button class="test-button" onclick="runFullSystemTest()">
                    ğŸš€ Teste Completo
                </button>
            </div>

            <!-- SeÃ§Ã£o 4: AÃ§Ãµes -->
            <div class="test-section">
                <h3>ğŸ® AÃ§Ãµes</h3>
                <button class="test-button success" onclick="openMainSystem()">
                    ğŸ  Abrir Sistema Principal
                </button>
                <button class="test-button warning" onclick="clearCache()">
                    ğŸ§¹ Limpar Cache
                </button>
                <button class="test-button" onclick="exportTestResults()">
                    ğŸ“Š Exportar Resultados
                </button>
                <button class="test-button" onclick="clearLog()">
                    ğŸ—‘ï¸ Limpar Log
                </button>
            </div>
        </div>

        <!-- Log Area -->
        <div class="log-area" id="logArea">
            <div class="info">ğŸš€ Sistema de teste inicializado</div>
            <div class="info">ğŸ“‹ Execute os testes clicando nos botÃµes acima</div>
        </div>
    </div>

    <script>
        let testResults = {};

        function log(message, type = 'info') {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = `[${timestamp}] ${message}`;
            logArea.appendChild(div);
            logArea.scrollTop = logArea.scrollHeight;
        }

        function clearLog() {
            document.getElementById('logArea').innerHTML = '';
            log('ğŸ§¹ Log limpo', 'info');
        }

        // Teste 1: Status Acordo
        function testStatusAcordo() {
            log('ğŸ¯ Testando status "acordo"...', 'info');
            
            const statusLabels = {
                'pendente': 'Pendente',
                'pago': 'Pago',
                'reciclado': 'Pago Reciclado',
                'acordo': 'Acordo'
            };

            const acordoLabel = statusLabels['acordo'];
            if (acordoLabel === 'Acordo') {
                log('âœ… Status "acordo" â†’ "Acordo" âœ“', 'success');
                testResults.statusAcordo = true;
            } else {
                log(`âŒ Status "acordo" â†’ "${acordoLabel}" (erro!)`, 'error');
                testResults.statusAcordo = false;
            }

            // Testar CSS
            const testElement = document.createElement('div');
            testElement.className = 'status-badge status-acordo';
            testElement.textContent = 'Acordo';
            document.body.appendChild(testElement);
            
            const styles = window.getComputedStyle(testElement);
            const bgColor = styles.backgroundColor;
            
            if (bgColor && bgColor !== 'rgba(0, 0, 0, 0)') {
                log('âœ… CSS para status-acordo aplicado âœ“', 'success');
            } else {
                log('âŒ CSS para status-acordo nÃ£o encontrado', 'error');
            }
            
            document.body.removeChild(testElement);
        }

        // Teste 2: Modal
        function testModalFunctionality() {
            log('ğŸ“± Testando funcionalidade do modal...', 'info');
            
            // Simular HTML do modal
            const modalHTML = `
                <input type="radio" name="aptStatus" value="acordo" id="testAcordo">
                <textarea id="apartmentObservations" placeholder="ObservaÃ§Ãµes"></textarea>
            `;
            
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = modalHTML;
            document.body.appendChild(tempDiv);
            
            // Testar seleÃ§Ã£o
            const acordoRadio = tempDiv.querySelector('#testAcordo');
            acordoRadio.checked = true;
            
            const selectedValue = tempDiv.querySelector('input[name="aptStatus"]:checked')?.value;
            
            if (selectedValue === 'acordo') {
                log('âœ… SeleÃ§Ã£o de "acordo" no modal funciona âœ“', 'success');
                testResults.modalFunctionality = true;
            } else {
                log('âŒ Problema na seleÃ§Ã£o do modal', 'error');
                testResults.modalFunctionality = false;
            }
            
            document.body.removeChild(tempDiv);
        }

        // Teste 3: PersistÃªncia
        function testStatusPersistence() {
            log('ğŸ’¾ Testando persistÃªncia de status...', 'info');
            
            // Simular salvamento
            const apartamento = { id: 'test-123', numero: '101', status: 'pendente' };
            const newStatus = 'acordo';
            
            // Simular atualizaÃ§Ã£o local
            apartamento.status = newStatus;
            
            if (apartamento.status === 'acordo') {
                log('âœ… AtualizaÃ§Ã£o local do status funciona âœ“', 'success');
                testResults.statusPersistence = true;
            } else {
                log('âŒ Problema na atualizaÃ§Ã£o local', 'error');
                testResults.statusPersistence = false;
            }
        }

        // Teste 4: Estrutura das Casas
        function testHouseStructure() {
            log('ğŸ—ï¸ Testando estrutura das casas...', 'info');
            
            const expectedStructure = {
                'Vacaria': [{ bloco: 25, quantidade: 4 }],
                'Ayres': [{ bloco: 1, quantidade: 2 }, { bloco: 30, quantidade: 3 }],
                'Vidal': [{ bloco: 20, quantidade: 4 }],
                'Taroni': [{ bloco: 1, quantidade: 3 }],
                'Destri': [{ bloco: 27, quantidade: 2 }, { bloco: 28, quantidade: 3 }],
                'Speranza': [{ bloco: 25, quantidade: 4 }]
            };
            
            let totalCasas = 0;
            Object.keys(expectedStructure).forEach(condominio => {
                const casas = expectedStructure[condominio];
                const totalCondominio = casas.reduce((sum, c) => sum + c.quantidade, 0);
                totalCasas += totalCondominio;
                
                log(`   ${condominio}: ${totalCondominio} casas`, 'info');
                casas.forEach(casa => {
                    log(`     Bloco ${casa.bloco}: ${casa.quantidade} casas`, 'info');
                });
            });
            
            log(`âœ… Total: ${totalCasas} casas organizadas`, 'success');
            testResults.houseStructure = true;
        }

        // Teste 5: PrevenÃ§Ã£o de Duplicatas
        function testDuplicatePrevention() {
            log('ğŸš« Testando prevenÃ§Ã£o de duplicatas...', 'info');
            
            // Simular verificaÃ§Ã£o de condomÃ­nios existentes
            const existingCondominios = [
                'CondomÃ­nio Vacaria',
                'CondomÃ­nio Ayres',
                'CondomÃ­nio Vidal'
            ];
            
            const expectedCondominios = [
                'CondomÃ­nio Vacaria',
                'CondomÃ­nio Ayres', 
                'CondomÃ­nio Vidal',
                'CondomÃ­nio Taroni',
                'CondomÃ­nio Destri',
                'CondomÃ­nio Speranza'
            ];
            
            const missing = expectedCondominios.filter(name => 
                !existingCondominios.some(existing => existing === name)
            );
            
            if (missing.length > 0) {
                log(`âœ… Detectados ${missing.length} condomÃ­nios faltando`, 'success');
                log(`   Faltando: ${missing.join(', ')}`, 'info');
                testResults.duplicatePrevention = true;
            } else {
                log('âœ… Todos os condomÃ­nios jÃ¡ existem - duplicaÃ§Ã£o prevenida', 'success');
                testResults.duplicatePrevention = true;
            }
        }

        // Teste 6: ValidaÃ§Ã£o da OrganizaÃ§Ã£o
        function validateHouseOrganization() {
            log('âœ… Validando organizaÃ§Ã£o das casas...', 'info');
            
            const inconsistencies = [
                'Ayres: Falta 1 casa (informado 6, detalhado 5)',
                'Speranza: Conta nÃ£o fecha (400 apt + 4 casas = 404, nÃ£o 388)'
            ];
            
            log('âš ï¸ InconsistÃªncias identificadas:', 'warning');
            inconsistencies.forEach(issue => {
                log(`   â€¢ ${issue}`, 'warning');
            });
            
            log('âœ… OrganizaÃ§Ã£o implementada conforme especificaÃ§Ã£o', 'success');
            testResults.houseOrganization = true;
        }

        // Testes do Sistema
        function testFirebaseConnection() {
            log('ğŸ”¥ Testando conexÃ£o Firebase...', 'info');
            
            if (typeof firebase !== 'undefined') {
                log('âœ… Firebase SDK disponÃ­vel', 'success');
            } else {
                log('âŒ Firebase SDK nÃ£o encontrado', 'error');
            }
            
            testResults.firebaseConnection = typeof firebase !== 'undefined';
        }

        function testServiceWorker() {
            log('ğŸ”„ Testando Service Worker...', 'info');
            
            if ('serviceWorker' in navigator) {
                log('âœ… Service Worker suportado', 'success');
                testResults.serviceWorker = true;
            } else {
                log('âŒ Service Worker nÃ£o suportado', 'error');
                testResults.serviceWorker = false;
            }
        }

        function testAuthentication() {
            log('ğŸ” Testando autenticaÃ§Ã£o...', 'info');
            
            const testCredentials = [
                'admin@condominio.com',
                'operador@condominio.com',
                'viewer@condominio.com'
            ];
            
            testCredentials.forEach(email => {
                log(`   âœ“ ${email}`, 'info');
            });
            
            log('âœ… Credenciais de teste disponÃ­veis', 'success');
            testResults.authentication = true;
        }

        // Teste Completo
        function runFullSystemTest() {
            log('ğŸš€ Executando teste completo do sistema...', 'info');
            
            testStatusAcordo();
            testModalFunctionality();
            testStatusPersistence();
            testHouseStructure();
            testDuplicatePrevention();
            validateHouseOrganization();
            testFirebaseConnection();
            testServiceWorker();
            testAuthentication();
            
            // Resumo
            const totalTests = Object.keys(testResults).length;
            const passedTests = Object.values(testResults).filter(result => result === true).length;
            
            log('', 'info');
            log('ğŸ“Š RESUMO DOS TESTES:', 'info');
            log(`   Total: ${totalTests} testes`, 'info');
            log(`   Passou: ${passedTests} testes`, passedTests === totalTests ? 'success' : 'warning');
            log(`   Falhou: ${totalTests - passedTests} testes`, 'info');
            
            if (passedTests === totalTests) {
                log('ğŸ‰ TODOS OS TESTES PASSARAM!', 'success');
            } else {
                log('âš ï¸ Alguns testes falharam - verificar logs acima', 'warning');
            }
        }

        // AÃ§Ãµes
        function openMainSystem() {
            log('ğŸ  Abrindo sistema principal...', 'info');
            window.open('index.html', '_blank');
        }

        function clearCache() {
            log('ğŸ§¹ Limpando cache...', 'info');
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => {
                        caches.delete(name);
                    });
                    log('âœ… Cache limpo', 'success');
                });
            }
        }

        function exportTestResults() {
            log('ğŸ“Š Exportando resultados...', 'info');
            
            const results = {
                timestamp: new Date().toISOString(),
                tests: testResults,
                summary: {
                    total: Object.keys(testResults).length,
                    passed: Object.values(testResults).filter(r => r === true).length,
                    failed: Object.values(testResults).filter(r => r === false).length
                }
            };
            
            const blob = new Blob([JSON.stringify(results, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `teste-resultados-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            
            log('âœ… Resultados exportados', 'success');
        }

        // Inicializar
        log('ğŸš€ Sistema de teste carregado', 'success');
        log('ğŸ“‹ Execute os testes individuais ou o teste completo', 'info');
    </script>
</body>
</html>