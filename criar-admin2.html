<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Criar Admin2</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        .info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        button {
            width: 100%;
            padding: 15px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px 0;
        }
        button:hover {
            background: #45a049;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .log {
            background: #263238;
            color: #aed581;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }
        .log div {
            margin: 5px 0;
        }
        .success {
            color: #4CAF50;
        }
        .error {
            color: #f44336;
        }
        .warning {
            color: #ff9800;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üë• Criar Admin2</h1>
        
        <div class="info">
            <strong>üìß Email:</strong> admin2@condominio.com<br>
            <strong>üîë Senha:</strong> a10b20c30@<br>
            <strong>üë§ Role:</strong> ADMIN<br>
            <strong>üè¢ Acesso:</strong> Todos os condom√≠nios
        </div>

        <button id="btnCreate" onclick="criarAdmin2()">
            ‚ûï Criar Admin2
        </button>

        <button onclick="testarLogin()">
            üîê Testar Login
        </button>

        <div class="log" id="log"></div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDw1XIkVyMMPfGLCeF4GpMJ6kEZ8HeeuF8",
            authDomain: "gestaodoscondominios.firebaseapp.com",
            projectId: "gestaodoscondominios",
            storageBucket: "gestaodoscondominios.firebasestorage.app",
            messagingSenderId: "20572242752",
            appId: "1:20572242752:web:c1b533c1bb905e81b0f0a5"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const logEl = document.getElementById('log');
        const btnCreate = document.getElementById('btnCreate');

        function log(msg, type = 'info') {
            const time = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.className = type;
            div.textContent = `[${time}] ${msg}`;
            logEl.appendChild(div);
            logEl.scrollTop = logEl.scrollHeight;
            console.log(msg);
        }

        window.criarAdmin2 = async function() {
            log('üîÑ Iniciando cria√ß√£o do Admin2...', 'info');
            btnCreate.disabled = true;
            btnCreate.textContent = 'Criando...';

            const email = 'admin2@condominio.com';
            const password = 'a10b20c30@';

            try {
                // 1. Verificar se j√° existe
                log('üîç Verificando se usu√°rio j√° existe...', 'info');
                try {
                    const userDoc = await getDoc(doc(db, 'users', email));
                    if (userDoc.exists()) {
                        log('‚ö†Ô∏è Usu√°rio j√° existe no Firestore', 'warning');
                        log('‚úÖ Voc√™ pode fazer login com as credenciais', 'success');
                        btnCreate.textContent = '‚úÖ Usu√°rio j√° existe';
                        return;
                    }
                } catch (e) {
                    log('‚ÑπÔ∏è Usu√°rio n√£o existe, criando...', 'info');
                }

                // 2. Criar usu√°rio no Firebase Auth
                log('üìù Criando usu√°rio no Firebase Auth...', 'info');
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                log(`‚úÖ Usu√°rio criado: ${user.uid}`, 'success');

                // 3. Criar perfil no Firestore
                log('üìù Criando perfil no Firestore...', 'info');
                await setDoc(doc(db, 'users', user.uid), {
                    email: email,
                    role: 'ADMIN',
                    condominios: [], // Acesso a todos
                    createdAt: new Date(),
                    updatedAt: new Date(),
                    displayName: 'Admin 2',
                    active: true
                });
                log('‚úÖ Perfil criado no Firestore', 'success');

                log('', 'info');
                log('üéâ ADMIN2 CRIADO COM SUCESSO!', 'success');
                log('', 'info');
                log('üìß Email: admin2@condominio.com', 'success');
                log('üîë Senha: a10b20c30@', 'success');
                log('', 'info');
                log('‚úÖ Agora voc√™ pode fazer login com essas credenciais', 'success');

                btnCreate.textContent = '‚úÖ Admin2 Criado!';
                btnCreate.style.background = '#4CAF50';

            } catch (error) {
                log(`‚ùå Erro: ${error.message}`, 'error');
                log(`üìã C√≥digo: ${error.code}`, 'error');

                if (error.code === 'auth/email-already-in-use') {
                    log('‚ö†Ô∏è Email j√° est√° em uso no Firebase Auth', 'warning');
                    log('‚úÖ Voc√™ pode fazer login com as credenciais', 'success');
                    btnCreate.textContent = '‚úÖ Usu√°rio j√° existe';
                } else {
                    btnCreate.textContent = '‚ùå Erro ao criar';
                    btnCreate.style.background = '#f44336';
                }

                console.error('Erro completo:', error);
            } finally {
                btnCreate.disabled = false;
            }
        };

        window.testarLogin = async function() {
            log('üîê Testando login...', 'info');

            const email = 'admin2@condominio.com';
            const password = 'a10b20c30@';

            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                log('‚úÖ Login bem-sucedido!', 'success');
                log(`üë§ UID: ${userCredential.user.uid}`, 'success');
                log(`üìß Email: ${userCredential.user.email}`, 'success');
                log('', 'info');
                log('‚úÖ Credenciais est√£o corretas!', 'success');
                log('üîó Voc√™ pode fazer login no sistema principal', 'success');

            } catch (error) {
                log(`‚ùå Erro no login: ${error.message}`, 'error');
                log(`üìã C√≥digo: ${error.code}`, 'error');

                if (error.code === 'auth/user-not-found') {
                    log('‚ö†Ô∏è Usu√°rio n√£o encontrado. Clique em "Criar Admin2"', 'warning');
                } else if (error.code === 'auth/wrong-password') {
                    log('‚ö†Ô∏è Senha incorreta', 'warning');
                }
            }
        };

        window.addEventListener('load', () => {
            log('üöÄ Sistema carregado', 'info');
            log('üìù Clique em "Criar Admin2" para come√ßar', 'info');
        });
    </script>
</body>
</html>
