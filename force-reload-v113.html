<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Force Reload v113</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            text-align: center;
        }
        
        h1 {
            font-size: 32px;
            margin-bottom: 10px;
            color: #333;
        }
        
        .version {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 30px;
        }
        
        .info {
            background: #f0f4ff;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            text-align: left;
        }
        
        .info h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .info ul {
            list-style: none;
            padding: 0;
        }
        
        .info li {
            padding: 8px 0;
            color: #555;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .info li::before {
            content: '‚úì';
            display: inline-block;
            width: 20px;
            height: 20px;
            background: #4CAF50;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 20px;
            font-weight: bold;
            font-size: 12px;
        }
        
        .button {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin-bottom: 15px;
        }
        
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }
        
        .button:active {
            transform: translateY(0);
        }
        
        .button.secondary {
            background: #f0f4ff;
            color: #667eea;
        }
        
        .log {
            background: #1e1e1e;
            color: #4CAF50;
            padding: 20px;
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            text-align: left;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
            display: none;
        }
        
        .log.show {
            display: block;
        }
        
        .log-line {
            margin: 5px 0;
            opacity: 0;
            animation: fadeIn 0.3s forwards;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîÑ Force Reload</h1>
        <div class="version">v113</div>
        
        <div class="info">
            <h3>üìã O que ser√° limpo:</h3>
            <ul>
                <li>Todos os caches do navegador</li>
                <li>Service Workers registrados</li>
                <li>LocalStorage e SessionStorage</li>
                <li>IndexedDB</li>
                <li>Cookies do site</li>
            </ul>
        </div>
        
        <button class="button" onclick="forceReload()">
            üöÄ Limpar Tudo e Recarregar
        </button>
        
        <button class="button secondary" onclick="voltarSistema()">
            ‚Üê Voltar ao Sistema
        </button>
        
        <div id="log" class="log"></div>
    </div>

    <script>
        const logEl = document.getElementById('log');
        
        function log(message, emoji = 'üìù') {
            const line = document.createElement('div');
            line.className = 'log-line';
            line.textContent = `${emoji} ${message}`;
            logEl.appendChild(line);
            logEl.scrollTop = logEl.scrollHeight;
        }
        
        async function forceReload() {
            logEl.classList.add('show');
            logEl.innerHTML = '';
            
            log('Iniciando limpeza completa...', 'üîÑ');
            
            try {
                // 1. Limpar todos os caches
                if ('caches' in window) {
                    log('Buscando caches...', 'üîç');
                    const cacheNames = await caches.keys();
                    log(`Encontrados ${cacheNames.length} caches`, 'üìä');
                    
                    for (const name of cacheNames) {
                        await caches.delete(name);
                        log(`Cache deletado: ${name}`, 'üóëÔ∏è');
                    }
                    log('Todos os caches deletados!', '‚úÖ');
                } else {
                    log('Cache API n√£o dispon√≠vel', '‚ö†Ô∏è');
                }
                
                // 2. Desregistrar Service Workers
                if ('serviceWorker' in navigator) {
                    log('Buscando Service Workers...', 'üîç');
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    log(`Encontrados ${registrations.length} Service Workers`, 'üìä');
                    
                    for (const registration of registrations) {
                        await registration.unregister();
                        log('Service Worker desregistrado', 'üóëÔ∏è');
                    }
                    log('Todos os Service Workers removidos!', '‚úÖ');
                } else {
                    log('Service Worker n√£o dispon√≠vel', '‚ö†Ô∏è');
                }
                
                // 3. Limpar LocalStorage
                log('Limpando LocalStorage...', 'üßπ');
                const localStorageKeys = Object.keys(localStorage);
                log(`Encontradas ${localStorageKeys.length} chaves`, 'üìä');
                localStorage.clear();
                log('LocalStorage limpo!', '‚úÖ');
                
                // 4. Limpar SessionStorage
                log('Limpando SessionStorage...', 'üßπ');
                const sessionStorageKeys = Object.keys(sessionStorage);
                log(`Encontradas ${sessionStorageKeys.length} chaves`, 'üìä');
                sessionStorage.clear();
                log('SessionStorage limpo!', '‚úÖ');
                
                // 5. Limpar IndexedDB
                if ('indexedDB' in window) {
                    log('Limpando IndexedDB...', 'üßπ');
                    const databases = await indexedDB.databases();
                    log(`Encontrados ${databases.length} bancos`, 'üìä');
                    
                    for (const db of databases) {
                        if (db.name) {
                            indexedDB.deleteDatabase(db.name);
                            log(`Banco deletado: ${db.name}`, 'üóëÔ∏è');
                        }
                    }
                    log('IndexedDB limpo!', '‚úÖ');
                } else {
                    log('IndexedDB n√£o dispon√≠vel', '‚ö†Ô∏è');
                }
                
                // 6. Limpar cookies
                log('Limpando cookies...', 'üßπ');
                const cookies = document.cookie.split(';');
                log(`Encontrados ${cookies.length} cookies`, 'üìä');
                
                for (const cookie of cookies) {
                    const eqPos = cookie.indexOf('=');
                    const name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;
                    document.cookie = name + '=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/';
                }
                log('Cookies limpos!', '‚úÖ');
                
                log('', '');
                log('üéâ LIMPEZA COMPLETA!', '‚úÖ');
                log('Recarregando em 2 segundos...', '‚è∞');
                
                // Marcar que deve for√ßar reload
                sessionStorage.setItem('force_reload_done', 'true');
                
                // Recarregar ap√≥s 2 segundos
                setTimeout(() => {
                    log('Recarregando p√°gina...', 'üîÑ');
                    window.location.href = '/';
                }, 2000);
                
            } catch (error) {
                log(`Erro: ${error.message}`, '‚ùå');
                console.error('Erro ao limpar:', error);
            }
        }
        
        function voltarSistema() {
            window.location.href = '/';
        }
        
        // Log inicial
        window.addEventListener('load', () => {
            log('Sistema pronto para limpeza', '‚úÖ');
        });
    </script>
</body>
</html>
